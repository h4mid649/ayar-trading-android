name: AYAR Trading Bot

# Ø²Ù…Ø§Ù†â€ŒÙ‡Ø§ÛŒ Ø§Ø¬Ø±Ø§
on:
  # Ø§Ø¬Ø±Ø§ÛŒ Ø¯Ø³ØªÛŒ
  workflow_dispatch:
    inputs:
      inscode:
        description: 'Ú©Ø¯ Ø³Ù‡Ù… (InsCode)'
        required: true
        default: '34144395039913458'
      capital:
        description: 'Ø³Ø±Ù…Ø§ÛŒÙ‡ (Ù…ÛŒÙ„ÛŒÙˆÙ† Ø±ÛŒØ§Ù„)'
        required: true
        default: '500'
      risk:
        description: 'Ø±ÛŒØ³Ú© (%)'
        required: true
        default: '1.0'

# Ú©Ø§Ø±Ù‡Ø§
jobs:
  trading:
    name: Ø§Ø¬Ø±Ø§ÛŒ Ø³ÛŒØ³ØªÙ… Ù…Ø¹Ø§Ù…Ù„Ø§ØªÛŒ
    runs-on: ubuntu-latest
    
    steps:
    # Ø¯Ø§Ù†Ù„ÙˆØ¯ Ú©Ø¯
    - name: ğŸ“¥ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ú©Ø¯ Ø§Ø² Repository
      uses: actions/checkout@v3
    
    # Ù†ØµØ¨ Python
    - name: ğŸ Ù†ØµØ¨ Python 3.10
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
    
    # Ù†ØµØ¨ Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§
    - name: ğŸ“¦ Ù†ØµØ¨ Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§ÛŒ Ù…ÙˆØ±Ø¯ Ù†ÛŒØ§Ø²
      run: |
        python -m pip install --upgrade pip
        pip install requests
    
    # Ø§Ø¬Ø±Ø§ÛŒ Ø¨Ø±Ù†Ø§Ù…Ù‡
    - name: ğŸš€ Ø§Ø¬Ø±Ø§ÛŒ Ø³ÛŒØ³ØªÙ… Ù…Ø¹Ø§Ù…Ù„Ø§ØªÛŒ
      env:
        INSCODE: ${{ github.event.inputs.inscode || '34144395039913458' }}
        CAPITAL: ${{ github.event.inputs.capital || '500' }}
        RISK: ${{ github.event.inputs.risk || '1.0' }}
      run: |
        echo "Ø´Ø±ÙˆØ¹ Ù…Ø¹Ø§Ù…Ù„Ù‡ Ø¨Ø§ ØªÙ†Ø¸ÛŒÙ…Ø§Øª:"
        echo "InsCode: $INSCODE"
        echo "Capital: $CAPITAL Ù…ÛŒÙ„ÛŒÙˆÙ†"
        echo "Risk: $RISK%"
        echo "------------------------"
        python ayar_trading.py \
          --inscode $INSCODE \
          --capital_rial $(($CAPITAL * 1000000)) \
          --risk_pct $RISK \
          --timeout 30 \
          --max_retries 3
    
    # Ø°Ø®ÛŒØ±Ù‡ Ù†ØªØ§ÛŒØ¬
    - name: ğŸ’¾ Ø°Ø®ÛŒØ±Ù‡ Ù„Ø§Ú¯â€ŒÙ‡Ø§ Ùˆ Ù†ØªØ§ÛŒØ¬
      if: always()
      uses: actions/upload-artifact@v3
      with:
        name: Ù†ØªØ§ÛŒØ¬-Ù…Ø¹Ø§Ù…Ù„Ù‡
        path: |
          ayar_trading.log
          ayar_state.json
          ayar_metrics.json
        retention-days: 30
